<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G√©n√©rateur d'Images - Rankwell</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Images Generator</h1>
            <p class="subtitle">Cr√©ez des images avec une direction artistique coh√©rente en changeant simplement le sujet</p>
        </header>

        <main>
            <!-- Mode de travail -->
            <section class="section">
                <h2>Step 1 : Mode de travail</h2>
                <div class="mode-selector">
                    <button class="mode-btn active" data-mode="manual">
                        <span class="mode-icon">‚úèÔ∏è</span>
                        <span class="mode-title">Cr√©ation manuelle</span>
                        <span class="mode-desc">Cr√©ez une image unique</span>
                    </button>
                    <button class="mode-btn" data-mode="scan">
                        <span class="mode-icon">üîç</span>
                        <span class="mode-title">Scanner une page</span>
                        <span class="mode-desc">Analysez une page et g√©n√©rez plusieurs images</span>
                    </button>
                    <button class="mode-btn" data-mode="csv">
                        <span class="mode-icon">üìä</span>
                        <span class="mode-title">Import CSV</span>
                        <span class="mode-desc">G√©n√©rez des images depuis un fichier CSV</span>
                    </button>
                </div>
            </section>

            <!-- S√©lection du style (commun aux deux modes) -->
            <section class="section">
                <h2>Step 2 : Choisissez votre style visuel</h2>
                <div class="style-grid">
                    <div class="style-card" data-style="v1">
                        <div class="style-preview v1-preview"></div>
                        <h3>3D Isom√©trique</h3>
                        <p>Moderne, tech-forward, gradients dynamiques</p>
                        <span class="style-tag">V1 - Original</span>
                    </div>
                    <div class="style-card" data-style="v2">
                        <div class="style-preview v2-preview"></div>
                        <h3>Glassmorphism</h3>
                        <p>Minimal, √©l√©gant, effets de verre</p>
                        <span class="style-tag">V2 - Glass</span>
                    </div>
                    <div class="style-card" data-style="v3">
                        <div class="style-preview v3-preview"></div>
                        <h3>Fluid Organic</h3>
                        <p>Formes fluides, gradients artistiques</p>
                        <span class="style-tag">V3 - Fluid</span>
                    </div>
                </div>
            </section>

            <!-- Section Import CSV -->
            <section class="section" id="csvSection" style="display: none;">
                <h2>Import CSV pour g√©n√©ration d'images</h2>
                
                <div class="csv-instructions">
                    <h3>üìã Instructions</h3>
                    <ul>
                        <li>Votre CSV doit contenir au moins une colonne avec "img" dans le nom (ex: <code>img_produit</code>, <code>image</code>, <code>img1</code>)</li>
                        <li>Les colonnes <strong>avant</strong> la colonne image seront utilis√©es comme contexte</li>
                        <li>L'IA analysera le contexte pour g√©n√©rer un sujet d'image pertinent</li>
                    </ul>
                    
                    <details>
                        <summary>üí° Exemple de CSV</summary>
                        <pre class="csv-example">Produit,Description,img_produit,Cat√©gorie,Prix
Nike Air Max,Chaussures de sport noires et blanches,[√† g√©n√©rer],Sport,120‚Ç¨
MacBook Pro,Ordinateur portable 16 pouces,[√† g√©n√©rer],Tech,2500‚Ç¨</pre>
                    </details>
                </div>

                <div class="csv-upload">
                    <label for="csvFileInput" class="csv-upload-label">
                        <span class="csv-upload-icon">üìÅ</span>
                        <span>Cliquez pour s√©lectionner un fichier CSV</span>
                        <input type="file" id="csvFileInput" accept=".csv" style="display: none;">
                    </label>
                    <p class="help-text">ou collez votre CSV ci-dessous</p>
                    <textarea id="csvTextInput" placeholder="Collez votre CSV ici..." rows="8"></textarea>
                    <button id="parseCSVBtn" class="btn-primary">
                        <span class="btn-icon">üìä</span>
                        Analyser le CSV
                    </button>
                </div>

                <!-- Aper√ßu du CSV -->
                <div id="csvPreview" style="display: none; margin-top: 2rem;">
                    <h3>Aper√ßu du CSV</h3>
                    <div class="csv-stats">
                        <span class="csv-stat"><strong id="csvRowCount">0</strong> lignes</span>
                        <span class="csv-stat"><strong id="csvColCount">0</strong> colonnes</span>
                        <span class="csv-stat"><strong id="csvImgCount">0</strong> image(s) √† g√©n√©rer</span>
                    </div>
                    <div class="csv-table-wrapper">
                        <table id="csvTable" class="csv-table"></table>
                    </div>
                    <button id="analyzeCSVBtn" class="btn-primary" style="margin-top: 1rem;">
                        <span class="btn-icon">ü§ñ</span>
                        Analyser et pr√©parer les images
                    </button>
                </div>

                <!-- Liste des images √† g√©n√©rer -->
                <div id="csvImageTasks" style="display: none; margin-top: 2rem;">
                    <h3>Images √† g√©n√©rer</h3>
                    <div id="csvTasksContainer"></div>
                    <div class="csv-actions" style="margin-top: 1.5rem;">
                        <button id="generateCSVImagesBtn" class="btn-primary">
                            <span class="btn-icon">üé®</span>
                            G√©n√©rer toutes les images
                        </button>
                        <button id="exportCSVBtn" class="btn-secondary">
                            <span class="btn-icon">üì•</span>
                            Exporter CSV avec URLs
                        </button>
                    </div>
                </div>
            </section>

            <!-- Section Scanner de page -->
            <section class="section" id="scanSection" style="display: none;">
                <h2>Step 3 : Scanner une page web</h2>
                <div class="scan-options">
                    <div class="scan-option">
                        <h3>Option 1 : URL de la page</h3>
                        <input 
                            type="url" 
                            id="urlInput" 
                            placeholder="https://exemple.com/page"
                            class="url-input"
                        >
                        <button id="scanUrlBtn" class="btn-secondary">
                            <span class="btn-icon">üîó</span>
                            Scanner l'URL
                        </button>
                        <p class="help-text">‚ö†Ô∏è Peut ne pas fonctionner √† cause des restrictions CORS</p>
                    </div>
                    
                    <div class="scan-divider">OU</div>
                    
                    <div class="scan-option">
                        <h3>Option 2 : Collez le HTML de la page</h3>
                        <textarea 
                            id="htmlInput" 
                            placeholder="Collez le HTML de votre page ici..."
                            rows="6"
                        ></textarea>
                        <button id="scanHtmlBtn" class="btn-secondary">
                            <span class="btn-icon">üìÑ</span>
                            Analyser le HTML
                        </button>
                        <p class="help-text">Conseil : Faites un clic droit sur la page ‚Üí "Afficher le code source" ‚Üí Copiez tout</p>
                    </div>
                </div>

                <!-- R√©sultats du scan -->
                <div id="scanResults" style="display: none; margin-top: 2rem;">
                    <h3>Sections d√©tect√©es</h3>
                    <div id="sectionsFound"></div>
                    
                    <button id="analyzeWithAIBtn" class="btn-primary" style="margin-top: 1rem;">
                        <span class="btn-icon">ü§ñ</span>
                        Analyser avec l'IA et sugg√©rer des images
                    </button>
                </div>

                <!-- Suggestions d'images -->
                <div id="imageSuggestions" style="display: none; margin-top: 2rem;">
                    <h3>Images sugg√©r√©es par l'IA</h3>
                    <div id="suggestionsContainer"></div>
                    
                    <div class="batch-actions" style="margin-top: 1.5rem;">
                        <button id="generateAllBtn" class="btn-primary">
                            <span class="btn-icon">üé®</span>
                            G√©n√©rer toutes les images s√©lectionn√©es
                        </button>
                    </div>
                </div>
            </section>

            <!-- Section cr√©ation manuelle -->
            <div id="manualSection">
            <!-- S√©lection du template de base -->
            <section class="section">
                <h2>Step 4 : Template de r√©f√©rence (optionnel)</h2>
                <select id="templateSelect" disabled>
                    <option value="">S√©lectionnez d'abord un style</option>
                </select>
                <p class="help-text">Choisissez un template existant pour en copier la structure</p>
            </section>

            <!-- Input du nouveau sujet -->
            <section class="section">
                <h2>Step 5 : D√©crivez votre nouveau sujet</h2>
                <textarea 
                    id="subjectInput" 
                    placeholder="Exemple: Un service de marketing automation avec des workflows intelligents et des campagnes personnalis√©es..."
                    rows="4"
                ></textarea>
                <p class="help-text">D√©crivez le sujet que vous souhaitez illustrer. L'IA va adapter le style choisi √† votre sujet.</p>
            </section>

            <!-- Bouton de g√©n√©ration du prompt -->
            <section class="section">
                <button id="generatePromptBtn" class="btn-primary" disabled>
                    <span class="btn-icon">‚ú®</span>
                    G√©n√©rer le prompt optimis√©
                </button>
            </section>

            <!-- Affichage du prompt g√©n√©r√© -->
            <section class="section" id="promptSection" style="display: none;">
                <h2>Step 6 : Prompt g√©n√©r√©</h2>
                <div class="prompt-display">
                    <div class="prompt-header">
                        <span class="prompt-label">Prompt pour g√©n√©ration d'image</span>
                        <button id="copyPromptBtn" class="btn-secondary">
                            <span class="btn-icon">üìã</span>
                            Copier
                        </button>
                    </div>
                    <div id="generatedPrompt" class="prompt-content"></div>
                </div>
                <div class="prompt-actions">
                    <button id="editPromptBtn" class="btn-secondary">
                        <span class="btn-icon">‚úèÔ∏è</span>
                        Modifier le prompt
                    </button>
                    <button id="generateImageBtn" class="btn-primary">
                        <span class="btn-icon">üñºÔ∏è</span>
                        G√©n√©rer l'image avec DALL-E
                    </button>
                </div>
            </section>

            <!-- Configuration API (collapsible) -->
            <section class="section config-section">
                <details>
                    <summary>‚öôÔ∏è Configuration API OpenAI</summary>
                    <div class="config-content">
                        <label for="apiKeyInput">Cl√© API OpenAI:</label>
                        <input 
                            type="password" 
                            id="apiKeyInput" 
                            placeholder="sk-..." 
                            autocomplete="off"
                        >
                        <p class="help-text">
                            Votre cl√© API est stock√©e localement dans votre navigateur et n'est jamais envoy√©e ailleurs qu'√† OpenAI.
                            <a href="https://platform.openai.com/api-keys" target="_blank">Obtenir une cl√© API</a>
                        </p>
                        <div class="model-select">
                            <label for="modelSelect">Mod√®le DALL-E:</label>
                            <select id="modelSelect">
                                <option value="dall-e-3">DALL-E 3 (meilleure qualit√©)</option>
                                <option value="dall-e-2">DALL-E 2 (plus rapide)</option>
                            </select>
                        </div>
                        <div class="size-select">
                            <label for="sizeSelect">Taille de l'image:</label>
                            <select id="sizeSelect">
                                <option value="1024x1024">1024x1024 (Carr√©)</option>
                                <option value="1792x1024">1792x1024 (Paysage - DALL-E 3 uniquement)</option>
                                <option value="1024x1792">1024x1792 (Portrait - DALL-E 3 uniquement)</option>
                            </select>
                        </div>
                        <div class="quality-select">
                            <label for="qualitySelect">Qualit√© (DALL-E 3):</label>
                            <select id="qualitySelect">
                                <option value="standard">Standard (plus rapide)</option>
                                <option value="hd">HD (meilleure qualit√©)</option>
                            </select>
                        </div>
                    </div>
                </details>
            </section>

            <!-- R√©sultat de g√©n√©ration -->
            <section class="section" id="resultSection" style="display: none;">
                    <h2>Step 7 : Image g√©n√©r√©e</h2>
                <div class="image-result">
                    <img id="generatedImage" alt="Image g√©n√©r√©e">
                    <div class="image-actions">
                        <button id="downloadImageBtn" class="btn-primary">
                            <span class="btn-icon">üíæ</span>
                            T√©l√©charger l'image
                        </button>
                        <button id="newGenerationBtn" class="btn-secondary">
                            <span class="btn-icon">üîÑ</span>
                            Nouvelle g√©n√©ration
                        </button>
                    </div>
                </div>
            </section>
            </div> <!-- Fin manualSection -->

            <!-- Historique des images g√©n√©r√©es -->
            <section class="section">
                <details>
                    <summary>üìö Historique des images g√©n√©r√©es (<span id="historyCount">0</span>)</summary>
                    <div class="history-content">
                        <div class="history-header">
                            <button id="refreshHistoryBtn" class="btn-secondary">
                                <span class="btn-icon">üîÑ</span>
                                Actualiser
                            </button>
                            <button id="exportHistoryBtn" class="btn-secondary">
                                <span class="btn-icon">üì•</span>
                                Exporter l'historique
                            </button>
                            <button id="clearHistoryBtn" class="btn-secondary">
                                <span class="btn-icon">üóëÔ∏è</span>
                                Vider l'historique
                            </button>
                        </div>
                        <div id="historyContainer" class="history-container">
                            <p class="help-text">Aucune image g√©n√©r√©e pour le moment</p>
                        </div>
                    </div>
                </details>
            </section>

            <!-- Loading et messages -->
            <div id="loadingOverlay" class="loading-overlay" style="display: none;">
                <div class="spinner"></div>
                <p id="loadingMessage">G√©n√©ration en cours...</p>
            </div>

            <div id="messageBox" class="message-box" style="display: none;">
                <span id="messageText"></span>
            </div>
        </main>

        <footer>
        </footer>
    </div>

    <script src="config.js"></script>
    <script src="api-client.js"></script>
    <script src="prompts-data.js"></script>
    <script src="prompt-generator.js"></script>
    <script src="page-scanner.js"></script>
    <script src="csv-parser.js"></script>
    <script src="image-storage.js"></script>
    <script src="app.js"></script>
</body>
</html>
